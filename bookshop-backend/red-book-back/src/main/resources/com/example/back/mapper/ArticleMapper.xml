<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.back.mapper.ArticleMapper">

    <select id="list" resultType="com.example.back.pojo.Article">
        SELECT * FROM article
        WHERE txt_type = #{type} AND is_review = 1 AND is_banned = 0
        LIMIT #{offset}, #{size}
    </select>

    <select id="listExcludeAuthor" resultType="com.example.back.pojo.Article">
        SELECT * FROM article
        WHERE txt_type = #{type} AND author_id != #{id} AND is_review = 1 AND is_banned = 0
        LIMIT #{offset}, #{size}
    </select>

    <update id="addLike">
        UPDATE article
        SET like_count = like_count + 1
        WHERE article_id = #{articleID}
    </update>

    <update id="subLike">
        UPDATE article
        SET like_count = like_count - 1
        WHERE article_id = #{articleID}
    </update>

    <update id="addStar">
        UPDATE article
        SET star_count = star_count + 1
        WHERE article_id = #{articleID}
    </update>

    <update id="subStar">
        UPDATE article
        SET star_count = star_count - 1
        WHERE article_id = #{articleID}
    </update>

    <select id="getArticlesByIds" resultType="com.example.back.pojo.Article">
        SELECT * FROM article WHERE article_id IN
        <foreach item="articleId" collection="articleIds" open="(" separator="," close=")">
            #{articleId}
        </foreach>
    </select>

    <select id="searchByTitleOrContent" resultType="com.example.back.pojo.Article">
        SELECT * FROM article
        WHERE (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
        AND is_review = 1 AND is_banned = 0
        LIMIT #{offset}, #{size}
    </select>

    <select id="searchByTitleOrContentExcludeAuthor" resultType="com.example.back.pojo.Article">
        SELECT * FROM article
        WHERE (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
        AND author_id != #{id} AND is_review = 1 AND is_banned = 0
        LIMIT #{offset}, #{size}
    </select>

    <select id="getArticlesByAuthorId" resultType="com.example.back.pojo.Article">
        SELECT * FROM article
        WHERE author_id = #{authorId} AND is_review = 1 AND is_banned = 0
        LIMIT #{offset}, #{size}
    </select>

    <insert id="save">
        INSERT INTO article (title, content, txt_type, author_id, like_count, star_count, publication_time, address, img, is_review, is_banned)
        VALUES (#{title}, #{content}, #{txt_type}, #{author_id}, #{like_count}, #{star_count}, #{publication_time}, #{address}, #{img}, #{is_review}, #{is_banned})
    </insert>

    <select id="getUnreviewedArticles" resultType="com.example.back.pojo.Article">
        SELECT * FROM article
        WHERE is_review = 0
        LIMIT #{offset}, #{size}
    </select>

    <select id="getBannedArticles" resultType="com.example.back.pojo.Article">
        SELECT * FROM article
        WHERE is_banned = 1
        LIMIT #{offset}, #{size}
    </select>

    <update id="setReviewedAndBanned">
        UPDATE article
        SET is_review = 1, is_banned = 1
        WHERE article_id = #{articleId}
    </update>

    <update id="setReviewed">
        UPDATE article
        SET is_review = 1
        WHERE article_id = #{articleId}
    </update>

    <update id="unbanArticle">
        UPDATE article
        SET is_banned = 0
        WHERE article_id = #{articleId}
    </update>

    <delete id="deleteArticle">
        DELETE FROM article WHERE article_id = #{article_id}
    </delete>

</mapper>